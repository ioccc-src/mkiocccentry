.\" section 1 man page for run_flex.sh
.\"
.\" This man page was first written by Cody Boone Ferguson for the IOCCC
.\" in 2022.
.\"
.\" Humour impairment is not virtue nor is it a vice, it's just plain
.\" wrong: almost as wrong as JSON spec mis-features and C++ obfuscation! :-)
.\"
.\" "Share and Enjoy!"
.\"     --  Sirius Cybernetics Corporation Complaints Division, JSON spec department. :-)
.\"
.TH run_flex.sh 1 "29 October 2022" "run_flex.sh" "IOCCC tools"
.SH NAME
run_flex.sh \- run
.B flex
to generate C code from a
.I *.l
file or use backup file if error
.SH SYNOPSIS
\fBrun_flex.sh\fP [\-h] [\-V] [\-v level] [\-o] [\-f flex] [\-l limit_ioccc.sh] [\-g verge] [\-p prefix] [\-s sorry.h] [\-S] [\-F dir] \-\- [flex_flags]
.SH DESCRIPTION
\fBrun_flex.sh\fP attempts to find a recent enough version of
.B flex
(minimum version defined in \fIlimit_ioccc.sh\fP or file specified by \fB\-l\fP option) and use it to generate code from the \fBprefix.l\fP file.
The default prefix is \fIjparse\fP but this script can be used for other scanners as well.
If a recent enough version is not found or
.B flex
encounters an error (syntax error or anything else) and the \fB\-o\fP option is not specified, it attempts to use the backup file \fIprefix.ref.c\fP.
.SH OPTIONS
.TP
\fB\-h\fP
Show help and exit.
.TP
\fB\-V\fP
Show version and exit.
.TP
\fB\-v \fIlevel\fP\fP
Set verbosity level to \fIlevel\fP.
.TP
\fB\-o\fP
Do \fBNOT\fP use backup file.
If
.B flex
cannot be used or fails to generate the file the script will fail.
.TP
\fB\-f \fIflex\fP\fP
Set
.B flex
basename to \fIflex\fP.
.TP
\fB\-l \fIlimit_ioccc.sh\fP\fP
Set path of version file to \fIlimit_ioccc.sh\fP.
.TP
\fB\-g \fIverge\fP\fP
Set path to the \fBverge\fP tool to \fIverge\fP.
This is used to determine if the
.B flex
tool is recent enough.
.TP
\fB\-p \fIprefix\fP\fP
Set prefix of file to use to \fIprefix\fP.
The
.B flex
input file will be \fIprefix.l\fP.
If the \fB\-o\fP option was not used and
.B flex
cannot be used or fails then the backup file
.I prefix.ref.c
will be used.
.TP
\fB\-s \fIsorry.h\fP\fP
Set path to file to prepend to the C output to \fIsorry.h\fP.
.TP
\fB\-S\fP
Suppress prepending apology to generated C output.
.TP
\fB\-F \fIflex_dir\fP\fP
Add a directory to search for
.B flex
in to \fIflex_dir\fP.
\fB\-F\fP can be used more than once.
If not used the script looks at \fB$PATH\fP.
.PP
The
.B flex_flags
are any optional flags to give to
.B flex
before the prefix.
.SH EXIT STATUS
.TP
0
.B flex
output file formed or backup file used instead
.TQ
1
.B flex
not found or too old and \fB\-o\fP used
.TQ
2
good
.B flex
found and ran but failed to form proper output file
.TQ
3
.B flex
input file missing or not readable: backup file had to be used
.TQ
4
backup file is missing, or are not readable
.TQ
5
failed to use backup file to form the
.B flex
C output file(s)
.TQ
6
.I limit_ioccc.sh
or
.I sorry.h
file missing/not readable or
.B verge
missing/not executable
.TQ
7
.B MIN_FLEX_VERSION
missing or empty from
.I limit_ioccc.sh
.TQ
8
\-h and help string printed or \-V and version string printed
.TQ
9
Command line usage error
.TQ
>=10
internal error
.SH NOTES
.PP
The \fB\-o\fP option is mainly for maintainers of the \fBjparse\fP scanner and parser but it can be used to test if you have a recent enough version of \fBflex\fP.
The idea behind it is if
.B flex
fails it might indicate a syntax error which the authors of \fBjparse\fP would need to fix.
.PP
Beware that some make implementations have a default rule for \fI*.l\fP file so that if one were to in this repo do:
.nf
.RS
\fB
 touch foo.l
 make\fP
.fi
.RE
.PP
the file \fIfoo.c\fP would be overwritten and cause a compilation error.
This appears to be because foo is actually referenced in the Makefile as a target.
.SH BUGS
.PP
If you have any issues with the tool you can open an issue at
.br
\fI\<https://github.com/ioccc\-src/mkiocccentry/issues\>\fP.
.SH EXAMPLES
.PP
Run \fBrun_flex.sh\fP with default options, which should attempt to run
.B flex
on the \fIjparse.l\fP file:
.nf
.RS
\fB
 ./run_flex.sh\fP
.fi
.RE
.PP
Run \fBrun_flex.sh\fP but specify that the backup file is not to be used in case a recent enough version of
.B flex
cannot be found or fails for some reason.

.nf
.RS
\fB
 ./run_flex.sh \-o\fP
.fi
.RE
.PP
Try and run
.B flex
on the file \fIfoobar.l\fP and don't use the backup file:
.nf
.RS
\fB
 ./run_flex.sh \-o \-p foobar\fP
.fi
.RE
.PP
Try and run
.B flex
on the file \fIfoobar.l\fP with lex instead of
.B flex
and don't use the backup file:
.nf
.RS
\fB
 ./run_flex.sh \-o \-p foobar \-f lex\fP
.fi
.RE
